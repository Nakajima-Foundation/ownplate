# 二要素認証（2FA）ユーザーガイド

## 二要素認証とは

二要素認証（Two-Factor Authentication、2FA）は、パスワードに加えて、スマートフォンの認証アプリで生成される6桁のコードを使ってログインする仕組みです。

パスワードだけでなく、あなたが持っているスマートフォンからのコードも必要になるため、不正ログインのリスクを大幅に減らすことができます。

## 必要なもの

- **認証アプリ**：以下のいずれかをスマートフォンにインストールしてください
  - Google Authenticator（推奨）
    - [iPhone版](https://apps.apple.com/jp/app/google-authenticator/id388497605)
    - [Android版](https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2)
  - Microsoft Authenticator
  - Authy
  - その他のTOTP対応認証アプリ

## 新規登録時に設定する

### 手順

1. **アカウント作成**
   - OwnPlateの新規登録画面でメールアドレスとパスワードを入力
   - 「次へ」をクリック

2. **二要素認証の設定画面が表示される**
   - QRコードが表示されます
   - この画面はスキップすることもできます（後で設定可能）

3. **QRコードをスキャン**
   - スマートフォンで認証アプリを起動
   - 「アカウントを追加」または「+」ボタンをタップ
   - 「QRコードをスキャン」を選択
   - 画面に表示されているQRコードをスキャン

4. **手動入力する場合**
   - QRコードの下に表示されている英数字のコードをメモ
   - 認証アプリで「手動で入力」を選択
   - アカウント名：「OwnPlate」
   - キー：メモしたコード
   - 時間ベース（Time-based）を選択

5. **コードを入力**
   - 認証アプリに表示される6桁のコードを入力
   - 「確認」ボタンをクリック

6. **設定完了**
   - チェックマークが表示されたら完了です
   - 次回ログイン時から二要素認証が有効になります

### スキップした場合

「スキップ」ボタンをクリックすると、二要素認証なしでアカウントが作成されます。
後から設定したい場合は、プロフィール画面から有効化できます。

## 既存アカウントで有効化する

すでにアカウントを持っている場合、プロフィール画面から二要素認証を有効化できます。

### 手順

1. **プロフィール画面を開く**
   - OwnPlateにログイン
   - 右上のメニューから「プロフィール」を選択
   - または `/u/profile` にアクセス

2. **二要素認証セクションを確認**
   - ステータスが「無効」と表示されています
   - 「二要素認証を有効にする」ボタンをクリック

3. **再認証が求められる場合**
   - セキュリティのため、パスワードの再入力が求められることがあります
   - パスワードを入力して「確認」をクリック

4. **QRコードをスキャン**
   - 新規登録時と同じ手順でQRコードをスキャン
   - 認証アプリに表示される6桁のコードを入力
   - 「確認」ボタンをクリック

5. **設定完了**
   - ステータスが「有効」に変わります
   - 次回ログイン時から二要素認証が有効になります

## 二要素認証でログインする

二要素認証を有効にしているアカウントでログインする方法です。

### 手順

1. **ログイン画面でメールアドレスとパスワードを入力**
   - 通常通り、メールアドレスとパスワードを入力
   - 「次へ」をクリック

2. **二要素認証コードの入力画面が表示される**
   - スマートフォンで認証アプリを開く
   - OwnPlateのアカウントに表示されている6桁のコードを確認
   - 画面にコードを入力

3. **ログイン完了**
   - コードが正しければログインできます

### 注意点

- コードは30秒ごとに変わります
- 古いコードは使えないので、最新のコードを入力してください
- 入力を間違えた場合は、新しいコードで再度試してください

## 二要素認証を無効化する

二要素認証を使わなくする方法です。

### 手順

1. **プロフィール画面を開く**
   - OwnPlateにログイン（二要素認証コードも入力）
   - プロフィール画面 (`/u/profile`) にアクセス

2. **無効化ボタンをクリック**
   - 「二要素認証を無効にする」ボタンをクリック

3. **確認ダイアログが表示される**
   - 「本当に二要素認証を無効にしますか？」という確認メッセージ
   - 「二要素認証を無効にする」ボタンをクリック

4. **再認証が求められる場合**
   - セキュリティのため、パスワードと二要素認証コードの再入力が必要です
   - パスワードを入力して「確認」をクリック
   - 二要素認証コードの入力欄が表示されます
   - 認証アプリから6桁のコードを入力して「確認」をクリック

5. **無効化完了**
   - ステータスが「無効」に変わります
   - 次回ログイン時から二要素認証なしでログインできます

### 認証アプリからの削除

二要素認証を無効化した後は、認証アプリからもOwnPlateのアカウントを削除できます。

- 認証アプリを開く
- OwnPlateのアカウントを長押し（またはタップ）
- 「削除」または「アカウントを削除」を選択

## トラブルシューティング

### コードが正しくないと表示される

**考えられる原因**:
- コードの有効期限が切れている（30秒ごとに変わります）
- スマートフォンの時刻がずれている

**解決方法**:
- 最新のコードを使用してください
- スマートフォンの設定で「自動日時設定」をオンにしてください
- 数秒待ってから、新しいコードで再試行してください

### 認証アプリを削除してしまった / スマートフォンを紛失した

**対処方法**:
現在のシステムでは、管理者によるサポートが必要です。

1. カスタマーサポートに連絡してください
2. アカウント情報（登録メールアドレス）を伝えてください
3. 管理者が二要素認証を解除します
4. 通常のパスワードでログインできるようになります
5. 必要に応じて、再度二要素認証を設定してください

**重要**: 認証アプリのバックアップを取っておくことをお勧めします。

### QRコードが表示されない

**考えられる原因**:
- セッションの有効期限が切れている

**解決方法**:
- パスワード再入力画面が表示された場合は、パスワードを入力してください
- QRコード画面が再表示されます

### 「メール認証が必要です」と表示される

二要素認証を設定するには、メールアドレスの認証が必要です。

**解決方法**:
1. 登録時に送信された確認メールを開く
2. メール内のリンクをクリックしてメールアドレスを認証
3. 再度二要素認証の設定を試す

## セキュリティのベストプラクティス

### 推奨事項

1. **強力なパスワードを使用する**
   - 二要素認証を有効にしても、パスワードは重要です
   - 長く複雑なパスワードを設定しましょう

2. **認証アプリのバックアップを取る**
   - Google Authenticatorの場合、クラウドバックアップ機能を有効にする
   - 複数のデバイスに認証アプリを設定する

3. **スマートフォンにロックをかける**
   - 認証アプリが入っているスマートフォンは必ずロックをかける
   - 生体認証（指紋・顔認証）を有効にする

4. **QRコード画面のスクリーンショットは取らない**
   - セキュリティリスクになります
   - 手動コードをメモする場合は、安全な場所に保管してください

### 注意事項

- **QRコードは一度しか表示されません**
  - 設定画面を閉じたら、同じQRコードは再表示できません
  - 再設定が必要な場合は、一度無効化してから再度有効化してください

- **コードを他人に教えない**
  - 6桁のコードは絶対に他人に教えないでください
  - OwnPlateのサポートがコードを尋ねることはありません

## よくある質問

### Q: 二要素認証は必須ですか？

A: いいえ、任意です。セキュリティを強化したい方にお勧めしています。

### Q: 複数のデバイスに設定できますか？

A: はい、同じQRコードを複数のデバイスでスキャンすれば、複数のデバイスで同じコードが生成されます。

**設定例**:
- スマートフォンとタブレット両方でQRコードをスキャン
- 自宅用と職場用のスマートフォン両方に設定
- スマートフォンとパソコン（Chrome拡張など）両方に設定

**推奨**: バックアップとして複数デバイスに設定しておくことをお勧めします。デバイスを紛失した場合でも、別のデバイスでログインできます。

**注意**: QRコードは登録時に一度しか表示されないため、複数デバイスに設定する場合は、その場ですべてのデバイスでスキャンしてください。

### Q: パソコンでも認証アプリを使えますか？

A: はい、Chrome拡張機能版のAuthenticatorなど、パソコン用の認証アプリもあります。ただし、スマートフォンでの使用を推奨します。

### Q: 認証コードはインターネット接続が必要ですか？

A: いいえ、認証アプリはオフラインでもコードを生成できます。

### Q: 機種変更したらどうなりますか？

A: 認証アプリのデータを新しいスマートフォンに移行する必要があります。
- Google Authenticatorの場合、クラウドバックアップ機能を使用
- 移行できない場合は、一度二要素認証を無効化してから再設定してください

### Q: パスワードを忘れた場合は？

A: パスワードリセット機能を使用してください。二要素認証はログイン後に使用されるため、パスワードリセットには影響しません。

## サポート

ご不明な点がございましたら、OwnPlateカスタマーサポートまでお問い合わせください。

---

**最終更新**: 2025年11月
